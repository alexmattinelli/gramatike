<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>Tickets de Suporte</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
<link href="https://fonts.googleapis.com/css2?family=Mansalva&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
body { font-family:'Nunito', system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif; margin:0; background:#f5f7fb; }
header { background:#9B5DE5; color:#fff; padding:1.5rem 1.5rem 2.5rem; display:flex; align-items:center; justify-content:space-between; border-bottom-left-radius:35px; border-bottom-right-radius:35px; }
h1 { margin:0; font-size:1.8rem; font-weight:400; font-family:'Mansalva', cursive; letter-spacing:1px; }
.table-wrap { max-width:1100px; margin:1.5rem auto; background:#fff; padding:1.25rem 1.5rem; border-radius:14px; box-shadow:0 4px 14px rgba(0,0,0,.06); }
.ticket { border:1px solid #e3e8f0; border-radius:10px; padding:1rem 1rem 1.1rem; margin-bottom:1rem; background:#fafbff; }
.ticket-header { display:flex; gap:.8rem; flex-wrap:wrap; align-items:center; }
.ticket-status { font-size:.65rem; letter-spacing:.5px; font-weight:600; padding:.35rem .55rem; border-radius:40px; text-transform:uppercase; }
.ticket-status.aberto { background:#fff6e0; color:#b67200; border:1px solid #f1d08c; }
.ticket-status.em_andamento { background:#ebf5ff; color:#1565c0; border:1px solid #b3dafc; }
.ticket-status.resolvido { background:#e6fbf1; color:#1b8a4d; border:1px solid #bfe9d1; }
.ticket-meta { font-size:.7rem; color:#5f6b7a; font-weight:600; }
.ticket-msg { margin:.75rem 0 .9rem; font-size:.85rem; line-height:1.4; color:#2d3846; white-space:pre-line; }
form.resposta { display:flex; flex-direction:column; gap:.55rem; background:#ffffff; border:1px solid #e6ebf2; padding:.75rem .85rem .95rem; border-radius:10px; }
form.resposta textarea { width:100%; min-height:70px; resize:vertical; font-family:'Nunito'; font-size:.8rem; padding:.55rem .6rem; border:1px solid #cfd7e3; border-radius:8px; }
form.resposta select, form.resposta button { font-size:.7rem; font-weight:600; border-radius:40px; border:1px solid #cfd7e3; padding:.5rem .9rem; cursor:pointer; }
form.resposta button { background:#9B5DE5; color:#fff; border:none; box-shadow:0 3px 10px rgba(155,93,229,.35); }
form.resposta button:hover { background:#9B5DE5; filter:brightness(0.95); }
.badge-user { background:#ece9ff; color:#4a3b9d; padding:.35rem .55rem; font-size:.65rem; border-radius:40px; font-weight:600; letter-spacing:.5px; }
.empty { text-align:center; padding:3rem 1rem; color:#5f6b7a; font-size:.85rem; }
</style>
</head>
<body>
<header>
  <h1>Tickets de Suporte</h1>
  <nav style="display:flex; gap:.6rem;">
    <a href="{{ url_for('admin.dashboard') }}" style="color:#fff; font-size:.75rem; text-decoration:none; font-weight:600; background:#ffffff22; padding:.45rem .8rem; border-radius:40px;">Dashboard</a>
    <a href="{{ url_for('main.index') }}" style="color:#fff; font-size:.75rem; text-decoration:none; font-weight:600; background:#ffffff22; padding:.45rem .8rem; border-radius:40px;">Início</a>
  </nav>
</header>
<div class="table-wrap">
  {% if tickets %}
    {% for t in tickets %}
      <div class="ticket">
        <div class="ticket-header">
          <span class="ticket-status {{ t.status }}">{{ t.status.replace('_',' ') }}</span>
          <span class="badge-user">{{ t.nome or (t.usuario.username if t.usuario) or 'Anônime' }}</span>
          <span class="ticket-meta">#{{ t.id }} • {{ t.created_at.strftime('%d/%m/%Y %H:%M') if t.created_at else '' }}</span>
          {% if t.email %}<span class="ticket-meta" style="margin-left:auto;">{{ t.email }}</span>{% endif %}
        </div>
        <div class="ticket-msg">{{ t.mensagem }}</div>
        {% if t.resposta %}
          <div style="background:#f1f5f9; padding:.6rem .7rem; border:1px solid #dde4ec; border-radius:8px; font-size:.72rem; line-height:1.35; color:#26323f; margin-bottom:.6rem;">
            <strong>Resposta:</strong><br>{{ t.resposta }}
          </div>
        {% endif %}
        <form class="resposta" method="post" action="{{ url_for('main.admin_suporte_responder', ticket_id=t.id) }}">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() if csrf_token is defined else '' }}" />
          <textarea name="resposta" placeholder="Responder / atualizar resposta..."></textarea>
          <div style="display:flex; gap:.5rem; flex-wrap:wrap; align-items:center;">
            <select name="status">
              <option value="">(manter status)</option>
              <option value="aberto">aberto</option>
              <option value="em_andamento">em andamento</option>
              <option value="resolvido">resolvido</option>
            </select>
            <button type="submit">Salvar</button>
          </div>
        </form>
      </div>
    {% endfor %}
  {% else %}
    <div class="empty">Nenhum ticket encontrado.</div>
  {% endif %}
</div>
</body>
</html>
