
<!DOCTYPE html>
<html lang="pt-BR">
<head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Gram√°tike Edu ‚Äî Exerc√≠cios</title>
  <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon.png') }}">
  <link rel="apple-touch-icon" href="{{ url_for('static', filename='img/icons/icon-192.png') }}">
        <link href="https://fonts.googleapis.com/css2?family=Mansalva&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
        <style>
                :root { --primary:#9B5DE5; --primary-dark:#7d3dc9; --bg:#f7f8ff; --card:#ffffff; --border:#e5e7eb; --text:#222; --text-dim:#666; }
                * { box-sizing:border-box; }
                body { margin:0; font-family:'Nunito',system-ui,-apple-system,'Segoe UI',Roboto,Arial,sans-serif; background:var(--bg); color:var(--text); line-height:1.55; display:flex; flex-direction:column; min-height:100vh; }
                h1,h2,h3 { font-weight:800; margin:0 0 .9rem; line-height:1.12; }
                header.site-head { background:#9B5DE5; padding:28px clamp(16px,4vw,40px) 46px; border-bottom-left-radius:40px; border-bottom-right-radius:40px; position:relative; display:flex; flex-direction:column; align-items:center; }
                .logo { font-family:'Mansalva', cursive; font-size:2.6rem; color:#fff; letter-spacing:1px; font-weight:400; margin:0; }
                .edu-nav { margin-top:1.1rem; display:flex; flex-wrap:wrap; gap:.65rem; justify-content:center; }
                .edu-nav a { text-decoration:none; font-weight:700; font-size:.7rem; letter-spacing:.55px; padding:.65rem 1.05rem .62rem; background:#ffffff18; color:#fff; border:1px solid #ffffff30; backdrop-filter:blur(4px); -webkit-backdrop-filter:blur(4px); border-radius:22px; display:inline-flex; align-items:center; gap:.35rem; box-shadow:0 4px 12px rgba(0,0,0,.18); transition:.25s; font-family:'Nunito',system-ui,-apple-system,'Segoe UI',Roboto,Arial,sans-serif; }
                .edu-nav a:hover, .edu-nav a.active { background:#fff; color:#7d3dc9; }
                main { width:100%; max-width:1200px; margin:2rem auto 4rem; padding:0 clamp(12px,3vw,40px); flex:1; }
                .page-title { text-align:center; font-size:2.1rem; color:#9B5DE5; margin:0 0 1.8rem; }
                .search-box form { display:flex; gap:.55rem; flex-wrap:nowrap; align-items:stretch; width:100%; max-width:860px; margin:0 auto 2rem; }
                .search-box input { flex:1; height:50px; border:1px solid var(--border); border-radius:20px; padding:0 1.15rem; font-size:.85rem; background:var(--card); font-weight:600; }
                .search-box button { height:50px; border:none; background:#9B5DE5; color:#fff; font-weight:700; font-size:.78rem; padding:0 1.4rem; border-radius:20px; cursor:pointer; letter-spacing:.4px; box-shadow:0 6px 20px rgba(155,93,229,.4); display:inline-flex; align-items:center; gap:.45rem; }
                .search-box button.icon-btn { width:50px; padding:0; justify-content:center; }
                .search-box button:hover { filter:brightness(1.07); }
                .topicos-nav { display:flex; flex-wrap:wrap; gap:.55rem; justify-content:center; margin:0 0 2rem; }
                .topicos-nav a { text-decoration:none; font-size:.6rem; font-weight:800; letter-spacing:.6px; padding:.55rem .85rem .5rem; background:#f1edff; color:#6233B5; border:1px solid #e3daf9; border-radius:18px; box-shadow:0 2px 6px rgba(155,93,229,.18); }
                .topicos-nav a:hover { background:#9B5DE5; color:#fff; border-color:#9B5DE5; }
                .exercise { background:var(--card); border:1px solid var(--border); border-radius:26px; padding:1.3rem 1.35rem 1.1rem; position:relative; box-shadow:0 10px 24px -6px rgba(0,0,0,.10); transition:.3s; margin:0 0 1.8rem; }
                .exercise:hover { box-shadow:0 18px 46px -10px rgba(0,0,0,.28); transform:translateY(-3px); }
                .exercise h4 { margin:0 0 .55rem; font-size:1.05rem; color:#6233B5; font-weight:800; letter-spacing:.4px; }
                .item-menu-trigger { position:absolute; top:10px; right:10px; background:#f1edff; border:1px solid #d6c9f2; border-radius:18px; width:34px; height:34px; display:flex; align-items:center; justify-content:center; cursor:pointer; box-shadow:0 4px 10px rgba(155,93,229,.25); }
                .item-menu { position:absolute; top:46px; right:10px; background:#fff; border:1px solid var(--border); border-radius:14px; box-shadow:0 14px 40px -8px rgba(0,0,0,.25); padding:.35rem 0; min-width:170px; display:none; z-index:30; }
                .item-menu.show { display:block; }
                .item-menu button { all:unset; display:block; width:100%; font-size:.7rem; font-weight:700; letter-spacing:.4px; padding:.55rem .85rem .5rem; cursor:pointer; color:#444; }
                .item-menu button:hover { background:#f1edff; color:#6233B5; }
                .item-menu form button.danger { color:#b42318; }
                .item-menu form button.danger:hover { background:#ffe4e1; }
                .item-menu form { margin:0; padding:0; }
                .question { font-size:.85rem; font-weight:700; margin:.9rem 0 .4rem; color:#222; padding-bottom:.6rem; }
                .question:not(:last-of-type) { border-bottom:1px solid #e8e5f3; margin-bottom:1.2rem; }
                .exercise h4 { border-bottom:2px solid #d6c9f2; padding-bottom:.5rem; margin-bottom:1rem; }
                .options label { display:block; margin:.25rem 0; cursor:pointer; font-size:.78rem; font-weight:600; color:#444; }
                textarea { width:100%; min-height:90px; border:1px solid #cfd5e3; border-radius:14px; padding:.7rem .85rem; font-family:inherit; font-size:.8rem; background:#f9f7ff; }
                textarea:focus { outline:2px solid #d9c6fa; }
                .feedback { font-size:.65rem; margin-top:.4rem; font-weight:800; letter-spacing:.4px; }
                .dificuldade-badge { display:inline-block; font-size:.65rem; font-weight:800; letter-spacing:.5px; padding:.35rem .7rem; border-radius:12px; margin-left:.5rem; vertical-align:middle; }
                .dificuldade-facil { background:#d1f4e0; color:#0a7c42; border:1px solid #9de4bd; }
                .dificuldade-media { background:#fff3cd; color:#856404; border:1px solid #ffd966; }
                .dificuldade-dificil { background:#f8d7da; color:#721c24; border:1px solid #f5c6cb; }
                footer { margin-top:4rem; background:#9B5DE5; color:#fff; text-align:center; padding:1.4rem 1rem 1.6rem; font-size:.75rem; letter-spacing:.5px; font-weight:700; border-top-left-radius:38px; border-top-right-radius:38px; }
                @media (max-width: 980px){ footer { display:none !important; } }
                @media (max-width:720px){ header.site-head { padding:24px 18px 38px; } .logo { font-size:2.2rem; } .exercise { padding:1.1rem 1rem .95rem; } }
        </style>
</head>
<body>
        <header class="site-head">
                <h1 class="logo">Gram√°tike Edu</h1>
                {% if current_user.is_authenticated and (current_user.is_admin or current_user.is_superadmin) %}
                        <a href="{{ url_for('admin.dashboard') }}" style="position:absolute; top:14px; right:16px; background:#ffffff22; border:1px solid #ffffff42; color:#fff; padding:6px 10px; font-size:11px; font-weight:700; border-radius:8px; text-decoration:none; letter-spacing:.5px; display:flex; align-items:center; gap:5px;">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>
                            </svg>
                            Painel
                        </a>
                {% endif %}
                <nav class="edu-nav" aria-label="Se√ß√µes educacionais">
                        <a href="{{ url_for('main.educacao') }}">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                                <polyline points="9 22 9 12 15 12 15 22"></polyline>
                            </svg>
                            In√≠cio
                        </a>
                        <a href="{{ url_for('main.apostilas') }}">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                                <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                            </svg>
                            Apostilas
                        </a>
                        <a href="{{ url_for('main.exercicios') }}" class="active">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                <line x1="12" y1="17" x2="12.01" y2="17"></line>
                            </svg>
                            Exerc√≠cios
                        </a>
                        {# Temporariamente desabilitados: Podcasts, Reda√ß√£o e V√≠deos
                        <a href="{{ url_for('main.podcasts') }}">üéß Podcasts</a>
                        <a href="{{ url_for('main.redacao') }}">‚úçÔ∏è Reda√ß√£o</a>
                        <a href="{{ url_for('main.videos') }}">üé¨ V√≠deos</a>
                        #}
                        <a href="{{ url_for('main.artigos') }}">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14 2 14 8 20 8"></polyline>
                                <line x1="16" y1="13" x2="8" y2="13"></line>
                                <line x1="16" y1="17" x2="8" y2="17"></line>
                                <polyline points="10 9 9 9 8 9"></polyline>
                            </svg>
                            Artigos
                        </a>
                </nav>
        </header>
        <main>
                <!-- T√≠tulo removido a pedido -->
                <div class="search-box">
                        <form method="get" action="">
                                <input type="text" name="q" placeholder="Pesquisar t√≠tulo ou descri√ß√£o..." value="{{ q }}" />
                                <button type="submit" class="icon-btn" aria-label="Buscar" title="Buscar">
                                        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.4" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                                                <circle cx="11" cy="11" r="7"></circle>
                                                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                                        </svg>
                                </button>
                        </form>
                </div>
                {% if etopics %}
                        <div class="topicos-nav">
                                {% for topico in etopics %}<a href="#etopico-{{ topico.id }}">{{ topico.nome }}</a>{% endfor %}
                                {% if q %}
                                <a href="?" class="clear-filters" style="background:#ffe4e1; color:#b42318; border-color:#ffb8b1; display:inline-flex; align-items:center; gap:.35rem;">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                        <line x1="18" y1="6" x2="6" y2="18"></line>
                                        <line x1="6" y1="6" x2="18" y2="18"></line>
                                    </svg>
                                    Limpar Filtros
                                </a>
                                {% endif %}
                        </div>
                {% endif %}

                {% for bloco in estrutura %}
                {% if bloco.sections or bloco.unsectioned %}
                <div id="etopico-{{ bloco.topic.id }}" style="margin-bottom:2.5rem;">
                        {% if bloco.sections %}
                                {% for sec in bloco.sections %}
                                        {% if sec.questions %}
                                        <div class="exercise">
                                                <h4>{{ sec.section.nome }}</h4>
                                                {% for qobj in sec.questions %}
                                                        <div class="question" style="position:relative;">
                                                                {{ loop.index }}. {{ qobj.enunciado }}
                                                                {% if qobj.dificuldade %}
                                                                        <span class="dificuldade-badge dificuldade-{{ qobj.dificuldade }}">
                                                                                {% if qobj.dificuldade == 'facil' %}F√°cil
                                                                                {% elif qobj.dificuldade == 'media' %}M√©dia
                                                                                {% elif qobj.dificuldade == 'dificil' %}Dif√≠cil
                                                                                {% endif %}
                                                                        </span>
                                                                {% endif %}
                                                                {% if current_user.is_authenticated and (current_user.is_admin or current_user.is_superadmin) %}
                                                                <button class="item-menu-trigger" aria-label="Menu">
                                                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                                                        <circle cx="12" cy="12" r="1"></circle>
                                                                        <circle cx="12" cy="5" r="1"></circle>
                                                                        <circle cx="12" cy="19" r="1"></circle>
                                                                    </svg>
                                                                </button>
                                                                <div class="item-menu" role="menu">
                                                                        <button type="button" data-edit="{{ qobj.id }}">Editar</button>
                                                                        <button type="button" data-view-answer="{{ qobj.id }}" data-resposta="{{ qobj.resposta|e }}">Ver Resposta</button>
                                                                        <form method="POST" action="/admin/edu/question/{{ qobj.id }}/delete" onsubmit="return confirm('Excluir esta quest√£o?');">
                                                                                <input type="hidden" name="csrf_token" value="{{ csrf_token() if csrf_token is defined else '' }}" />
                                                                                <input type="hidden" name="next" value="{{ request.url }}" />
                                                                                <button type="submit" class="danger">Excluir</button>
                                                                        </form>
                                                                </div>
                                                                {% endif %}
                                                        </div>
                                                        <div data-qid="{{ qobj.id }}" class="q-block" data-tipo="{{ qobj.tipo }}" data-opcoes="{{ qobj.opcoes|e }}" data-resposta="{{ qobj.resposta|e }}"></div>
                                                {% endfor %}
                                        </div>
                                        {% endif %}
                                {% endfor %}
                        {% endif %}
                        {% if bloco.unsectioned %}
                        <div class="exercise">
                                <h4>Sem sess√£o</h4>
                                {% for qobj in bloco.unsectioned %}
                                        <div class="question" style="position:relative;">
                                                {{ loop.index }}. {{ qobj.enunciado }}
                                                {% if qobj.dificuldade %}
                                                        <span class="dificuldade-badge dificuldade-{{ qobj.dificuldade }}">
                                                                {% if qobj.dificuldade == 'facil' %}F√°cil
                                                                {% elif qobj.dificuldade == 'media' %}M√©dia
                                                                {% elif qobj.dificuldade == 'dificil' %}Dif√≠cil
                                                                {% endif %}
                                                        </span>
                                                {% endif %}
                                                {% if current_user.is_authenticated and (current_user.is_admin or current_user.is_superadmin) %}
                                                <button class="item-menu-trigger" aria-label="Menu">
                                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                                        <circle cx="12" cy="12" r="1"></circle>
                                                        <circle cx="12" cy="5" r="1"></circle>
                                                        <circle cx="12" cy="19" r="1"></circle>
                                                    </svg>
                                                </button>
                                                <div class="item-menu" role="menu">
                                                        <button type="button" data-edit="{{ qobj.id }}">Editar</button>
                                                        <button type="button" data-view-answer="{{ qobj.id }}" data-resposta="{{ qobj.resposta|e }}">Ver Resposta</button>
                                                        <form method="POST" action="/admin/edu/question/{{ qobj.id }}/delete" onsubmit="return confirm('Excluir esta quest√£o?');">
                                                                <input type="hidden" name="csrf_token" value="{{ csrf_token() if csrf_token is defined else '' }}" />
                                                                <input type="hidden" name="next" value="{{ request.url }}" />
                                                                <button type="submit" class="danger">Excluir</button>
                                                        </form>
                                                </div>
                                                {% endif %}
                                        </div>
                                        <div data-qid="{{ qobj.id }}" class="q-block" data-tipo="{{ qobj.tipo }}" data-opcoes="{{ qobj.opcoes|e }}" data-resposta="{{ qobj.resposta|e }}"></div>
                                {% endfor %}
                        </div>
                        {% endif %}
                </div>
                {% endif %}
                {% endfor %}
                {% if not estrutura %}<p>Nenhum exerc√≠cio.</p>{% endif %}
                </main>

        <!-- Modal de Edi√ß√£o de Quest√£o -->
        <dialog id="editQuestionDialog" style="border:none; border-radius:20px; padding:0; max-width:600px; width:90%;">
                <form id="editQuestionForm" method="POST" style="display:grid; gap:.9rem; padding:1.5rem;">
                        <h3 style="margin:0; font-size:1.3rem; color:#6233B5;">Editar Quest√£o</h3>
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() if csrf_token is defined else '' }}" />
                        <input type="hidden" id="eq_id" name="id" />
                        <input type="hidden" id="eq_next" name="next" />
                        
                        <label style="display:grid; gap:.3rem;">
                                <span style="font-size:.75rem; font-weight:700; color:#666;">Enunciado</span>
                                <textarea id="eq_enunciado" name="enunciado" required style="min-height:100px; border:1px solid #cfd7e2; border-radius:10px; padding:.65rem .75rem; font-size:.85rem;"></textarea>
                        </label>
                        
                        <label style="display:grid; gap:.3rem;">
                                <span style="font-size:.75rem; font-weight:700; color:#666;">Resposta</span>
                                <textarea id="eq_resposta" name="resposta" style="min-height:80px; border:1px solid #cfd7e2; border-radius:10px; padding:.65rem .75rem; font-size:.85rem;"></textarea>
                        </label>
                        
                        <label style="display:grid; gap:.3rem;">
                                <span style="font-size:.75rem; font-weight:700; color:#666;">Tipo</span>
                                <select id="eq_tipo" name="tipo" style="border:1px solid #cfd7e2; border-radius:10px; padding:.65rem .75rem; font-size:.85rem;">
                                        <option value="multipla_escolha">M√∫ltipla Escolha</option>
                                        <option value="verdadeiro_falso">Verdadeiro/Falso</option>
                                        <option value="lacunas">Preencher Lacunas</option>
                                        <option value="discursiva">Discursiva</option>
                                </select>
                        </label>
                        
                        <label style="display:grid; gap:.3rem;">
                                <span style="font-size:.75rem; font-weight:700; color:#666;">Op√ß√µes (JSON)</span>
                                <textarea id="eq_opcoes" name="opcoes" style="min-height:60px; border:1px solid #cfd7e2; border-radius:10px; padding:.65rem .75rem; font-size:.85rem; font-family:monospace;"></textarea>
                        </label>
                        
                        <label style="display:grid; gap:.3rem;">
                                <span style="font-size:.75rem; font-weight:700; color:#666;">Dificuldade</span>
                                <select id="eq_dificuldade" name="dificuldade" style="border:1px solid #cfd7e2; border-radius:10px; padding:.65rem .75rem; font-size:.85rem;">
                                        <option value="">Nenhuma</option>
                                        <option value="facil">F√°cil</option>
                                        <option value="media">M√©dia</option>
                                        <option value="dificil">Dif√≠cil</option>
                                </select>
                        </label>
                        
                        <menu style="display:flex; gap:.6rem; justify-content:flex-end; margin:0; padding-top:.6rem;">
                                <button type="button" id="eq_cancel" style="padding:.65rem 1.2rem; border:1px solid #cfd7e2; background:#f9f9f9; border-radius:12px; font-weight:700; cursor:pointer;">Cancelar</button>
                                <button type="submit" style="padding:.65rem 1.2rem; border:none; background:#9B5DE5; color:#fff; border-radius:12px; font-weight:700; cursor:pointer;">Salvar</button>
                        </menu>
                </form>
        </dialog>

        <!-- Barra de navega√ß√£o inferior mobile (tipo app/rede social) -->
        <style>
          /* Barra de navega√ß√£o inferior para mobile */
          .mobile-bottom-nav {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #ffffff;
            border-top: 1px solid #e5e7eb;
            padding: 8px 0 calc(8px + env(safe-area-inset-bottom));
            box-shadow: 0 -4px 12px rgba(0,0,0,.08);
            z-index: 1000;
          }

          @media (max-width: 980px){
            .mobile-bottom-nav {
              display: flex;
              justify-content: space-around;
              align-items: center;
            }
            
            main {
              margin-bottom: calc(60px + env(safe-area-inset-bottom)) !important;
            }
            
            footer {
              display: none !important;
            }
          }

          .mobile-bottom-nav a {
            all: unset;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            padding: 6px 12px;
            cursor: pointer;
            color: #666;
            font-size: 0.65rem;
            font-weight: 600;
            letter-spacing: 0.3px;
            transition: color 0.2s;
            text-decoration: none;
          }

          .mobile-bottom-nav a:active {
            transform: scale(0.95);
          }

          .mobile-bottom-nav a svg {
            color: #666;
            transition: color 0.2s;
          }

          .mobile-bottom-nav a:hover {
            color: var(--primary);
          }

          .mobile-bottom-nav a:hover svg {
            color: var(--primary);
          }
        </style>
        
        <nav class="mobile-bottom-nav" aria-label="Navega√ß√£o principal mobile">
          <a href="{{ url_for('main.index') }}" aria-label="Feed" title="Feed">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
              <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
            <span>In√≠cio</span>
          </a>
          
          <a href="{{ url_for('main.educacao') }}" aria-label="Educa√ß√£o" title="Educa√ß√£o" style="color: var(--primary);">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
              <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
            </svg>
            <span>Educa√ß√£o</span>
          </a>
          
          <a href="{{ url_for('main.novo_post') }}" aria-label="Criar post" title="Criar post" style="background: var(--primary); color: white; border-radius: 50%; width: 48px; height: 48px; margin: -10px 0; padding: 0; display: flex; align-items: center; justify-content: center; flex-direction: row;">
            <svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
          </a>
          
          <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 4px; padding: 6px 12px; color: #666; font-size: 0.65rem; font-weight: 600; letter-spacing: 0.3px; text-decoration: none;">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"></circle>
              <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
            <span>Em breve</span>
          </div>
          
          {% if current_user.is_authenticated %}
          <a href="{{ url_for('main.meu_perfil') }}" aria-label="Perfil" title="Perfil">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
            <span>Perfil</span>
          </a>
          {% else %}
          <a href="{{ url_for('main.login') }}" aria-label="Entrar" title="Entrar">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path>
              <polyline points="10 17 15 12 10 7"></polyline>
              <line x1="15" y1="12" x2="3" y2="12"></line>
            </svg>
            <span>Entrar</span>
          </a>
          {% endif %}
        </nav>

        <footer>¬© 2025 Gram√°tike ‚Ä¢ Inclus√£o e G√™nero Neutro</footer>

<script>
// Renderiza√ß√£o b√°sica dos tipos de quest√µes
document.querySelectorAll('.q-block').forEach(block=>{
    const tipo = block.dataset.tipo; let opcoes={}; try{ opcoes=JSON.parse(block.dataset.opcoes||'{}'); }catch(e){}
    const resp = block.dataset.resposta||'';
    if(tipo==='multipla_escolha' && Array.isArray(opcoes.alternativas)){
        const alts = opcoes.alternativas.map((a,i)=>`<label><input type='radio' name='q${block.dataset.qid}' value='${i}'> ${a}</label>`).join('');
        block.innerHTML = `<div class='options'>${alts}</div><button class='btn-checar' data-cor='${opcoes.correta ?? -1}' style='margin-top:.45rem;'>Verificar</button><div class='feedback'></div>`;
    } else if(tipo==='verdadeiro_falso'){
        block.innerHTML = `<label><input type='radio' name='q${block.dataset.qid}' value='verdadeiro'> Verdadeiro</label><label><input type='radio' name='q${block.dataset.qid}' value='falso'> Falso</label><button class='btn-checar' data-resp='${resp}' style='margin-top:.45rem;'>Verificar</button><div class='feedback'></div>`;
    } else if(tipo==='lacunas'){
        if(opcoes.frase){
            const count=(opcoes.frase.match(/___/g)||[]).length;
            const inputs=Array.from({length:count},(_,i)=>`<input class='lacuna' data-i='${i}' style='width:120px; padding:4px 6px; margin:3px;' placeholder='${i+1}'>`).join(' ');
            block.innerHTML = `<div style='margin:.3rem 0;'>${opcoes.frase.replace(/___/g,"<span style='display:inline-block; min-width:70px; border-bottom:2px dashed #888; margin:0 4px; height:20px;'></span>")}</div>${inputs}<br><button class='btn-checar' data-resp='${(opcoes.respostas||[]).join('|')}' style='margin-top:.45rem;'>Verificar</button><div class='feedback'></div>`;
        }
    } else if(tipo==='discursiva'){
        block.innerHTML = `<textarea style='width:100%; min-height:80px;'></textarea><br><button class='btn-checar' data-palavras='${(opcoes.keywords||[]).join(',')}' style='margin-top:.45rem;'>Enviar</button><div class='feedback'></div>`;
    } else { block.textContent='Tipo n√£o suportado ainda.'; }
});

document.addEventListener('click',e=>{
    if(e.target.classList.contains('btn-checar')){
        const btn=e.target; const parent=btn.closest('.q-block'); const fb=parent.querySelector('.feedback'); const tipo=parent.dataset.tipo; fb.textContent=''; fb.style.color='#333';
        if(tipo==='multipla_escolha'){
            const correta=parseInt(btn.dataset.cor,10); const selected=[...parent.querySelectorAll('input[type=radio]')].find(r=>r.checked); if(!selected){ fb.textContent='Selecione uma op√ß√£o.'; fb.style.color='#c47'; return; }
            const val=parseInt(selected.value,10); if(val===correta){ fb.textContent='Correto!'; fb.style.color='green'; } else { fb.textContent='Incorreto.'; fb.style.color='red'; }
        } else if(tipo==='verdadeiro_falso'){
            const esperada=btn.dataset.resp; const selected=[...parent.querySelectorAll('input[type=radio]')].find(r=>r.checked); if(!selected){ fb.textContent='Selecione uma op√ß√£o.'; return; }
            fb.textContent= selected.value===esperada ? 'Correto!' : 'Incorreto.'; fb.style.color= selected.value===esperada ? 'green':'red';
        } else if(tipo==='lacunas'){
            const esperado=(btn.dataset.resp||'').split('|'); const inputs=[...parent.querySelectorAll('.lacuna')]; let ok=true; inputs.forEach((inp,i)=>{ if((inp.value||'').trim().toLowerCase() !== (esperado[i]||'').toLowerCase()) ok=false; });
            fb.textContent= ok ? 'Perfeito!' : 'Revise suas respostas.'; fb.style.color= ok ? 'green':'red';
        } else if(tipo==='discursiva'){
            const palavras=(btn.dataset.palavras||'').split(',').filter(Boolean); const texto=parent.querySelector('textarea').value.toLowerCase(); const hits=palavras.filter(p=>texto.includes(p.toLowerCase()));
            fb.textContent = palavras.length ? `Palavras-chave encontradas: ${hits.length}/${palavras.length}` : 'Enviado!'; fb.style.color= hits.length===palavras.length ? 'green':'#c47';
        }
    }
});

// Menu toggle functionality
document.addEventListener('click', e => {
    const trigger = e.target.closest('.item-menu-trigger');
    if (trigger) {
        e.preventDefault();
        e.stopPropagation();
        const menu = trigger.nextElementSibling;
        if (menu && menu.classList.contains('item-menu')) {
            // Close all other menus
            document.querySelectorAll('.item-menu.show').forEach(m => {
                if (m !== menu) m.classList.remove('show');
            });
            menu.classList.toggle('show');
        }
        return;
    }
    
    // Edit button - load question data and show modal
    const editBtn = e.target.closest('[data-edit]');
    if (editBtn) {
        e.preventDefault();
        const id = editBtn.getAttribute('data-edit');
        fetch(`/admin/edu/question/${id}.json`, { credentials: 'same-origin' })
            .then(r => r.json())
            .then(data => {
                document.getElementById('eq_id').value = data.id;
                document.getElementById('eq_enunciado').value = data.enunciado || '';
                document.getElementById('eq_resposta').value = data.resposta || '';
                document.getElementById('eq_tipo').value = data.tipo || 'multipla_escolha';
                document.getElementById('eq_opcoes').value = data.opcoes || '';
                document.getElementById('eq_dificuldade').value = data.dificuldade || '';
                document.getElementById('eq_next').value = window.location.href;
                document.getElementById('editQuestionDialog').showModal();
            })
            .catch(err => {
                alert('Erro ao carregar dados da quest√£o');
                console.error(err);
            });
        return;
    }
    
    // View answer button
    const viewBtn = e.target.closest('[data-view-answer]');
    if (viewBtn) {
        e.preventDefault();
        const resposta = viewBtn.getAttribute('data-resposta');
        alert(resposta || 'Sem resposta cadastrada');
        return;
    }
    
    // Close menus when clicking outside
    if (!e.target.closest('.item-menu')) {
        document.querySelectorAll('.item-menu.show').forEach(m => m.classList.remove('show'));
    }
});

// Modal edit form submission
document.getElementById('editQuestionForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const formData = new FormData(this);
    const id = document.getElementById('eq_id').value;
    
    fetch(`/admin/edu/question/${id}/update`, {
        method: 'POST',
        body: formData,
        credentials: 'same-origin'
    })
    .then(r => {
        if (r.redirected) {
            window.location.href = r.url;
        } else {
            return r.text();
        }
    })
    .catch(err => {
        alert('Erro ao atualizar quest√£o');
        console.error(err);
    });
});

// Modal cancel button
document.getElementById('eq_cancel').addEventListener('click', () => {
    document.getElementById('editQuestionDialog').close();
});
</script>
</body>

</html>
