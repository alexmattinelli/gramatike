
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gram√°tike Edu ‚Äî Podcasts</title>
  <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon.png') }}">
  <link rel="apple-touch-icon" href="{{ url_for('static', filename='img/icons/icon-192.png') }}">
    <link href="https://fonts.googleapis.com/css2?family=Mansalva&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root { --primary:#9B5DE5; --primary-dark:#7d3dc9; --bg:#f7f8ff; --card:#ffffff; --border:#e5e7eb; --text:#222; --text-dim:#666; }
        * { box-sizing:border-box; }
        body { margin:0; font-family:'Nunito',system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif; background:var(--bg); color:var(--text); line-height:1.55; display:flex; flex-direction:column; min-height:100vh; }
        h1,h2,h3 { font-weight:800; margin:0 0 .9rem; line-height:1.12; }
        header.site-head { background:#9B5DE5; padding:28px clamp(16px,4vw,40px) 46px; border-bottom-left-radius:40px; border-bottom-right-radius:40px; position:relative; display:flex; flex-direction:column; align-items:center; }
        .logo { font-family:'Mansalva', cursive; font-size:2.6rem; color:#fff; letter-spacing:1px; font-weight:400; margin:0; }
        .edu-nav { margin-top:1.1rem; display:flex; flex-wrap:wrap; gap:.65rem; justify-content:center; }
    .edu-nav a { text-decoration:none; font-weight:700; font-size:.7rem; letter-spacing:.55px; padding:.65rem 1.05rem .62rem; background:#ffffff18; color:#fff; border:1px solid #ffffff30; backdrop-filter:blur(4px); -webkit-backdrop-filter:blur(4px); border-radius:22px; display:inline-flex; align-items:center; gap:.35rem; box-shadow:0 4px 12px rgba(0,0,0,.18); transition:.25s; font-family:'Nunito',system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif; }
        .edu-nav a:hover, .edu-nav a.active { background:#fff; color:#7d3dc9; }
        main { width:100%; max-width:1280px; margin:2rem auto 4rem; padding:0 clamp(12px,3vw,40px); flex:1; }
    .search-box form { display:flex; gap:.55rem; max-width:860px; margin:0 auto 2.0rem; }
    .search-box input { flex:1; height:50px; border:1px solid var(--border); border-radius:20px; padding:0 1.15rem; font-size:.85rem; background:var(--card); font-weight:600; box-shadow:0 2px 4px -2px rgba(0,0,0,.06); }
    .search-box input::placeholder { color:#999; font-weight:500; letter-spacing:.3px; }
    .search-box button { height:50px; border:none; background:#9B5DE5; color:#fff; font-weight:700; font-size:.78rem; padding:0 1.4rem; border-radius:20px; cursor:pointer; letter-spacing:.45px; box-shadow:0 6px 20px rgba(155,93,229,.4); display:inline-flex; align-items:center; gap:.45rem; transition:.25s; }
    .search-box button.icon-btn { width:50px; padding:0; justify-content:center; }
    .search-box button:hover { filter:brightness(1.07); transform:translateY(-1px); }
    .topics-bar { display:flex; flex-wrap:wrap; gap:.55rem; justify-content:center; margin:0 0 2rem; }
    .topics-bar a { text-decoration:none; font-size:.6rem; font-weight:800; letter-spacing:.6px; padding:.55rem .85rem .5rem; background:#f1edff; color:#6233B5; border:1px solid #e3daf9; border-radius:18px; box-shadow:0 2px 6px rgba(155,93,229,.18); transition:.25s; }
    .topics-bar a:hover { background:#9B5DE5; color:#fff; border-color:#9B5DE5; }
        .podcast-list { list-style:none; margin:0; padding:0; display:grid; gap:1rem; grid-template-columns:repeat(3, 1fr); }
        @media (max-width:1100px){ .podcast-list { grid-template-columns:repeat(2,1fr); } }
        @media (max-width:720px){ .podcast-list { grid-template-columns:repeat(1,1fr); } }
        .podcast-item { background:var(--card); border:1px solid var(--border); border-radius:22px; padding:1rem 1rem .85rem; position:relative; box-shadow:0 6px 16px -4px rgba(0,0,0,.10); transition:.28s; overflow:hidden; }
        .podcast-item:hover { box-shadow:0 14px 34px -8px rgba(0,0,0,.25); transform:translateY(-2px); }
        .podcast-title { font-size:.9rem; font-weight:800; letter-spacing:.45px; color:#6233B5; margin:0 0 .45rem; }
        .podcast-item p { margin:.4rem 0 0; font-size:.65rem; line-height:1.35; color:var(--text-dim); font-weight:500; }
        .podcast-item iframe, .podcast-item audio { margin-top:.5rem; border-radius:14px; width:100%; box-shadow:0 4px 14px -4px rgba(0,0,0,.15); }
        .podcast-item iframe[height="352"] { height:300px; }
        .meta-author { margin:.28rem 0 0; font-size:.55rem; font-weight:700; letter-spacing:.55px; text-transform:uppercase; color:#7d3dc9; }
    .item-menu-trigger { position:absolute; top:8px; right:8px; background:#f1edff; border:1px solid #d6c9f2; border-radius:16px; width:30px; height:30px; display:flex; align-items:center; justify-content:center; cursor:pointer; box-shadow:0 3px 8px rgba(155,93,229,.25); z-index:40; }
    .item-menu { position:absolute; top:46px; right:10px; background:#fff; border:1px solid var(--border); border-radius:14px; box-shadow:0 14px 40px -8px rgba(0,0,0,.25); padding:.35rem 0; min-width:170px; display:none; z-index:9999; }
        .item-menu.show { display:block; }
        .item-menu button { all:unset; display:block; width:100%; font-size:.7rem; font-weight:700; letter-spacing:.4px; padding:.55rem .85rem .5rem; cursor:pointer; color:#444; }
        .item-menu button:hover { background:#f1edff; color:#6233B5; }
        .item-menu form button.danger { color:#b42318; }
        .item-menu form button.danger:hover { background:#ffe4e1; }
    /* Evitar que o card se mova quando o menu est√° aberto e evitar que a m√≠dia capture cliques acima do menu */
    .podcast-item.menu-open:hover { transform:none; box-shadow:0 6px 16px -4px rgba(0,0,0,.10); }
    .podcast-item.menu-open iframe,
    .podcast-item.menu-open audio { pointer-events:none; }
    footer { margin-top:4rem; background:#9B5DE5; color:#fff; text-align:center; padding:1.4rem 1rem 1.6rem; font-size:.75rem; letter-spacing:.5px; font-weight:700; border-top-left-radius:38px; border-top-right-radius:38px; }
        .topics-bar::-webkit-scrollbar { height:8px; }
        .topics-bar::-webkit-scrollbar-thumb { background:#d5c6f5; border-radius:4px; }
        dialog#editPodcastDialog { width:min(94vw, 860px); border:0; border-radius:20px; padding:0; box-shadow:0 28px 54px -8px rgba(0,0,0,.45); }
        dialog#editPodcastDialog::backdrop { background:rgba(0,0,0,.45); backdrop-filter:blur(2px); }
        #editPodcastForm { padding:1rem 1.1rem 1.2rem; display:grid; gap:.9rem; }
        #editPodcastForm h3 { margin:.1rem 0 .2rem; font-size:1.05rem; }
        #editPodcastForm label { font-size:.65rem; font-weight:800; letter-spacing:.6px; text-transform:uppercase; color:#6233B5; }
        #editPodcastForm input, #editPodcastForm textarea, #editPodcastForm select { width:100%; border:1px solid var(--border); border-radius:14px; padding:.65rem .8rem; background:#f9f7ff; font-size:.75rem; font-weight:600; }
        #editPodcastForm textarea { min-height:110px; }
        #editPodcastForm menu { display:flex; gap:.6rem; justify-content:flex-end; margin:0; padding-top:.3rem; }
        #editPodcastForm button { border:none; border-radius:16px; background:#9B5DE5; color:#fff; font-weight:700; font-size:.7rem; padding:.55rem 1.2rem .5rem; cursor:pointer; letter-spacing:.5px; }
        #editPodcastForm button#ep_cancel { background:#f1edff; color:#6233B5; }
        #editPodcastForm button#ep_cancel:hover { background:#e4d7fb; }
        #editPodcastForm button.nav-button { background:#6233B5; }
        #editPodcastForm button.nav-button:hover { filter:brightness(1.08); }
        @media (max-width:720px){
            .podcast-list { grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); }
            header.site-head { padding:24px 18px 38px; }
            .logo { font-size:2.2rem; }
            .search-box form { flex-direction:column; }
            .search-box input { width:100%; }
        }
    </style>
</head>
<body class="nunito-font">
    <header class="site-head">
        <h1 class="logo">Gram√°tike Edu</h1>
        {% if current_user.is_authenticated and (current_user.is_admin or current_user.is_superadmin) %}
            <a href="{{ url_for('admin.dashboard') }}" style="position:absolute; top:14px; right:16px; background:#ffffff22; border:1px solid #ffffff42; color:#fff; padding:6px 10px; font-size:11px; font-weight:700; border-radius:8px; text-decoration:none; letter-spacing:.5px;">üõ†Ô∏è Painel</a>
        {% endif %}
        <nav class="edu-nav" aria-label="Se√ß√µes educacionais">
            <a href="{{ url_for('main.educacao') }}">üè† In√≠cio</a>
            <a href="{{ url_for('main.apostilas') }}">üìö Apostilas</a>
            <a href="{{ url_for('main.exercicios') }}">üß† Exerc√≠cios</a>
            <a href="{{ url_for('main.podcasts') }}" class="active">üéß Podcasts</a>
            <a href="{{ url_for('main.redacao') }}">‚úçÔ∏è Reda√ß√£o</a>
            <a href="{{ url_for('main.videos') }}">üé¨ V√≠deos</a>
            <a href="{{ url_for('main.artigos') }}">üìë Artigos</a>
        </nav>
    </header>
    <main>
        <!-- T√≠tulo removido a pedido -->
        {% if topics %}
            <div class="topics-bar">
                {% for topico in topics %}
                    <a href="#topico-{{ topico.id }}">{{ topico.nome }}</a>
                {% endfor %}
            </div>
        {% endif %}
        <div class="search-box">
            <form method="get" action="">
                <input type="text" name="q" value="{{ q }}" placeholder="Pesquisar t√≠tulo ou descri√ß√£o..." />
                <button type="submit" class="icon-btn" aria-label="Buscar" title="Buscar">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.4" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                        <circle cx="11" cy="11" r="7"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                </button>
            </form>
        </div>
    <!-- Lista -->
        <ul class="podcast-list">
            {% for c in conteudos %}
            {% set extra = (c.extra | fromjson) if c.extra else None %}
            <li class="podcast-item" id="topico-{{ c.id }}">
                <div class="podcast-title">{{ c.titulo }}</div>
                {# Garante que vari√°veis n√£o vazem entre itens #}
                {% set embed_src = None %}
                {% set sid = None %}
                {% set kind = None %}
                {% if current_user.is_authenticated and (current_user.is_admin or current_user.is_superadmin) %}
                <button class="item-menu-trigger" aria-label="Menu">
                    <span style="width:4px;height:4px;background:#4b5d73;border-radius:50%;display:inline-block;margin:0 1px;"></span>
                    <span style="width:4px;height:4px;background:#4b5d73;border-radius:50%;display:inline-block;margin:0 1px;"></span>
                    <span style="width:4px;height:4px;background:#4b5d73;border-radius:50%;display:inline-block;margin:0 1px;"></span>
                </button>
                <div class="item-menu" role="menu">
                    <button type="button" data-edit="{{ c.id }}">Editar</button>
                    <form method="POST" action="/admin/edu/content/{{ c.id }}/delete" onsubmit="return confirm('Excluir este podcast?');">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                        <input type="hidden" name="next" value="{{ request.url }}" />
                        <button type="submit" class="danger">Excluir</button>
                    </form>
                </div>
                {% endif %}
                {# Spotify embed direto #}
                {% if extra and (extra.spotify_embed or extra.spotify or extra.spotify_url or extra.spotify_link) %}
                    {% set raw_sp = extra.spotify_embed or extra.spotify or extra.spotify_url or extra.spotify_link %}
                    {% set lower_sp = raw_sp|lower %}
                    {% if 'iframe' in lower_sp %}
                        {{ raw_sp | safe }}
                    {% else %}
                        {% set kind = None %}
                        {% if raw_sp.startswith('spotify:') %}
                            {% set parts = raw_sp.split(':') %}
                            {% if parts|length >=3 %}
                                {% set kind = parts[1] %}
                                {% set sid = parts[2] %}
                                {% set embed_src = 'https://open.spotify.com/embed/' ~ kind ~ '/' ~ sid ~ '?utm_source=generator' %}
                            {% endif %}
                        {% else %}
                            {% if '/episode/' in lower_sp %}{% set kind='episode' %}{% elif '/show/' in lower_sp %}{% set kind='show' %}{% elif '/track/' in lower_sp %}{% set kind='track' %}{% elif '/playlist/' in lower_sp %}{% set kind='playlist' %}{% elif '/album/' in lower_sp %}{% set kind='album' %}{% elif '/artist/' in lower_sp %}{% set kind='artist' %}{% endif %}
                            {% if kind %}
                                {% set sid = raw_sp.split('/' ~ kind ~ '/')[1].split('?')[0].split('/')[0] %}
                                {% set embed_src = 'https://open.spotify.com/embed/' ~ kind ~ '/' ~ sid ~ '?utm_source=generator' %}
                            {% endif %}
                        {% endif %}
                        {% if embed_src %}
                            <iframe title="Spotify" style="border-radius:12px; margin-top:.5rem;" src="{{ embed_src }}" width="100%" height="352" frameborder="0" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" allowfullscreen loading="lazy" referrerpolicy="strict-origin-when-cross-origin"></iframe>
                        {% else %}
                            <a href="{{ raw_sp }}" target="_blank" rel="noopener" style="font-size:.7rem;font-weight:700;display:inline-block;margin-top:.4rem;">Abrir no Spotify ‚ñ∂</a>
                        {% endif %}
                    {% endif %}
                {% elif c.url and ('spotify.com/' in (c.url|lower) or c.url.startswith('spotify:')) %}
                    {% set spot = c.url %}
                    {% set lower_sp2 = spot|lower %}
                    {% if spot.startswith('spotify:') %}
                        {% set parts = spot.split(':') %}
                        {% if parts|length >=3 %}
                            {% set embed_src = 'https://open.spotify.com/embed/' ~ parts[1] ~ '/' ~ parts[2] ~ '?utm_source=generator' %}
                        {% endif %}
                    {% else %}
                        {% set kind = None %}
                        {% if '/episode/' in lower_sp2 %}{% set kind='episode' %}{% elif '/show/' in lower_sp2 %}{% set kind='show' %}{% elif '/track/' in lower_sp2 %}{% set kind='track' %}{% elif '/playlist/' in lower_sp2 %}{% set kind='playlist' %}{% elif '/album/' in lower_sp2 %}{% set kind='album' %}{% elif '/artist/' in lower_sp2 %}{% set kind='artist' %}{% endif %}
                        {% if kind %}
                            {% set sid = spot.split('/' ~ kind ~ '/')[1].split('?')[0].split('/')[0] %}
                            {% set embed_src = 'https://open.spotify.com/embed/' ~ kind ~ '/' ~ sid ~ '?utm_source=generator' %}
                        {% endif %}
                    {% endif %}
                    {% if embed_src %}
                        <iframe title="Spotify" style="border-radius:12px; margin-top:.5rem;" src="{{ embed_src }}" width="100%" height="352" frameborder="0" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" allowfullscreen loading="lazy" referrerpolicy="strict-origin-when-cross-origin"></iframe>
                    {% else %}
                        <a href="{{ spot }}" target="_blank" rel="noopener" style="font-size:.7rem;font-weight:700;display:inline-block;margin-top:.4rem;">Abrir no Spotify ‚ñ∂</a>
                    {% endif %}
                {# Campo extra com √°udio (audio_url, audio, audio_mp3) #}
                {% elif extra and (extra.audio_url or extra.audio or extra.audio_mp3) %}
                    {% set au = extra.audio_url or extra.audio or extra.audio_mp3 %}
                    <audio controls preload="none" style="margin-top:.6rem; width:100%; border-radius:12px;">
                        <source src="{{ au }}" type="audio/{{ 'mp3' if '.mp3' in au|lower else ('mpeg' if '.m4a' in au|lower else 'wav') }}">
                        Seu navegador n√£o suporta √°udio.
                    </audio>
                {# URL crua contendo extens√£o de √°udio em qualquer posi√ß√£o (mesmo com query) #}
                {% elif c.url and ('.mp3' in c.url|lower or '.m4a' in c.url|lower or '.wav' in c.url|lower or '.ogg' in c.url|lower) %}
                    <audio controls preload="none" style="margin-top:.6rem; width:100%; border-radius:12px;">
                        <source src="{{ c.url }}">
                        Seu navegador n√£o suporta √°udio.
                    </audio>
                {# iframe salvo em url #}
                {% elif c.url and '<iframe' in c.url %}
                    {# Se um iframe foi salvo por engano em url, renderiza-o #}
                    {{ c.url | safe }}
                {% elif c.url and c.url.lower().endswith('.mp3') %}
                    <audio controls preload="none">
                        <source src="{{ c.url }}" type="audio/mpeg" />
                        Seu navegador n√£o suporta √°udio.
                    </audio>
                {% elif c.url %}
                    <a href="{{ c.url }}" target="_blank" rel="noopener" style="font-size:.8rem;">Abrir link</a>
                {% else %}
                    <span style="font-size:.65rem; color:#777;">Sem m√≠dia.</span>
                {% endif %}
                                                {% if c.resumo %}<p>{{ c.resumo }}</p>{% endif %}
                                                {% if c.extra and (c.extra | fromjson).author %}
                                                    <p class="meta-author">Autore/Canal: {{ (c.extra | fromjson).author }}</p>
                                                {% endif %}
            </li>
            {% else %}
                                        <li class="podcast-item"><span style="font-size:.7rem; color:var(--text-dim); font-weight:600;">Nenhum podcast publicado.</span></li>
            {% endfor %}
        </ul>
        {% if current_user.is_authenticated and (current_user.is_admin or current_user.is_superadmin) %}
        <dialog id="editPodcastDialog">
            <form id="editPodcastForm" method="post">
                <h3>Editar Podcast</h3>
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                <input type="hidden" name="content_id" id="ep_id" />
                <label style="display:block; font-size:.8rem; margin:.4rem 0 .2rem;">T√≠tulo</label>
                <input name="titulo" id="ep_titulo" required />
                <label style="display:block; font-size:.8rem; margin:.6rem 0 .2rem;">Autore/Canal</label>
                <input name="autor" id="ep_autor" />
                <label style="display:block; font-size:.8rem; margin:.6rem 0 .2rem;">Resumo</label>
                <textarea name="resumo" id="ep_resumo" rows="3"></textarea>
                <label style="display:block; font-size:.8rem; margin:.6rem 0 .2rem;">URL/iframe do Spotify ou .mp3</label>
                <input name="url" id="ep_url" />
                <label style="display:block; font-size:.8rem; margin:.6rem 0 .2rem;">T√≥pico</label>
                <select name="topic_id" id="ep_topic">
                    <option value="">(T√≥pico)</option>
                    {% for t in topics %}<option value="{{ t.id }}">{{ t.nome }}</option>{% endfor %}
                </select>
                <menu style="display:flex; gap:8px; justify-content:flex-end; margin-top:12px;">
                    <button type="button" id="ep_cancel">Cancelar</button>
                    <button type="submit" class="nav-button" style="padding:.5rem 1rem; border-radius:8px;">Salvar</button>
                </menu>
            </form>
        </dialog>
        <style>
            /* Modal de edi√ß√£o de podcast ampliado e mais confort√°vel */
            #editPodcastDialog{ width:min(94vw, 860px); border:0; border-radius:14px; padding:0; box-shadow:0 24px 44px rgba(16,24,40,.22), 0 0 0 1px rgba(16,24,40,.06); }
            #editPodcastDialog::backdrop{ background:rgba(13,20,33,.45); backdrop-filter: blur(2px); }
            #editPodcastForm{ padding:1rem 1rem 1.1rem; display:grid; gap:.9rem; grid-template-columns:1fr; }
            #editPodcastForm h3{ margin:.2rem 0 .4rem; font-size:1.08rem; letter-spacing:.2px; }
            #editPodcastForm label{ display:block; font-size:.78rem; font-weight:700; color:#3f4f63; }
            #editPodcastForm input, #editPodcastForm textarea, #editPodcastForm select{ width:100%; padding:.65rem .75rem; border:1px solid #cfd7e2; border-radius:10px; background:#f9fbfd; font-size:.85rem; }
            #editPodcastForm textarea{ min-height:110px; }
            #editPodcastForm menu{ padding-top:.2rem; }
            @media (min-width: 900px){
                #editPodcastForm{ grid-template-columns:1fr 1fr; }
                #editPodcastForm h3, #editPodcastForm menu{ grid-column:1 / -1; }
            }
        </style>
        <script>
        (function(){
            const list = document.querySelector('.podcast-list');
            if(!list) return;
            // Toggle menu 3 pontinhos
            list.addEventListener('click', (e)=>{
                const trigger = e.target.closest('.item-menu-trigger');
                if(trigger){
                    e.preventDefault();
                    const item = trigger.closest('.podcast-item');
                    const menu = item.querySelector('.item-menu');
                    const open = menu.classList.contains('show');
                    document.querySelectorAll('.item-menu.show').forEach(m=>{
                        m.classList.remove('show');
                        const li = m.closest('.podcast-item');
                        if(li) li.classList.remove('menu-open');
                    });
                    if(!open){
                        menu.classList.add('show');
                        item.classList.add('menu-open');
                    }
                    return;
                }
                if(!e.target.closest('.item-menu')){
                    document.querySelectorAll('.item-menu.show').forEach(m=>{
                        m.classList.remove('show');
                        const li = m.closest('.podcast-item');
                        if(li) li.classList.remove('menu-open');
                    });
                }
            });
            // Editar via modal
            const dlg = document.getElementById('editPodcastDialog');
            const form = document.getElementById('editPodcastForm');
            const ep_id = document.getElementById('ep_id');
            const ep_titulo = document.getElementById('ep_titulo');
            const ep_resumo = document.getElementById('ep_resumo');
            const ep_url = document.getElementById('ep_url');
            const ep_topic = document.getElementById('ep_topic');
            const ep_cancel = document.getElementById('ep_cancel');
            const ep_autor = document.getElementById('ep_autor');
            list.addEventListener('click', async (e)=>{
                const btn = e.target.closest('[data-edit]');
                if(!btn) return;
                const id = btn.getAttribute('data-edit');
                try{
                    const data = await fetch(`/admin/edu/content/${id}.json`).then(r=>r.json());
                    ep_id.value = data.id;
                    ep_titulo.value = data.titulo||'';
                    ep_resumo.value = data.resumo||'';
                    ep_autor.value = (data.extra && data.extra.author) ? data.extra.author : '';
                    ep_url.value = data.url||'';
                    // Seleciona o t√≥pico atual
                    [...ep_topic.options].forEach(o=>{ o.selected = String(o.value)===String(data.topic_id||''); });
                    dlg.showModal();
                }catch(err){ alert('Falha ao carregar'); }
            });
            ep_cancel.addEventListener('click', ()=> dlg.close());
            form.addEventListener('submit', async (e)=>{
                e.preventDefault();
                const id = ep_id.value;
                const fd = new FormData(form);
                try{
                    const res = await fetch(`/admin/edu/content/${id}/update`, { method:'POST', body: fd });
                    if(res.ok){ dlg.close(); location.reload(); } else { alert('Falha ao salvar'); }
                }catch(err){ alert('Erro de rede'); }
            });
            // Fecha menus ao clicar fora
            document.addEventListener('click', (e)=>{
                if(!e.target.closest('.podcast-item')){
                    document.querySelectorAll('.item-menu.show').forEach(m=>m.classList.remove('show'));
                }
            });
        })();
        </script>
        {% endif %}
        <div style="margin-top:2.2rem; display:flex; justify-content:center; gap:.65rem; flex-wrap:wrap;">
            {% if page and last_page %}
                {% set base_q = ('?q=' ~ q) if q else '' %}
                {% if page > 1 %}
                    <a href="{{ url_for('main.podcasts') }}{{ base_q }}{{ '&' if base_q else '?' }}page=1" style="text-decoration:none; font-size:.65rem; font-weight:800; letter-spacing:.5px; padding:.55rem .9rem .5rem; background:#f1edff; border:1px solid #e2d6f9; color:#6233B5; border-radius:18px;">¬´ Primeiro</a>
                    <a href="{{ url_for('main.podcasts') }}{{ base_q }}{{ '&' if base_q else '?' }}page={{ page-1 }}" style="text-decoration:none; font-size:.65rem; font-weight:800; letter-spacing:.5px; padding:.55rem .9rem .5rem; background:#f1edff; border:1px solid #e2d6f9; color:#6233B5; border-radius:18px;">‚Äπ Anterior</a>
                {% endif %}
                <span style="font-size:.6rem; font-weight:800; letter-spacing:.55px; color:#7d3dc9; padding:.55rem .8rem .5rem; background:#fff; border:1px solid #e2d6f9; border-radius:18px;">P√°gina {{ page }} / {{ last_page }}</span>
                {% if page < last_page %}
                    <a href="{{ url_for('main.podcasts') }}{{ base_q }}{{ '&' if base_q else '?' }}page={{ page+1 }}" style="text-decoration:none; font-size:.65rem; font-weight:800; letter-spacing:.5px; padding:.55rem .9rem .5rem; background:#f1edff; border:1px solid #e2d6f9; color:#6233B5; border-radius:18px;">Pr√≥xima ‚Ä∫</a>
                    <a href="{{ url_for('main.podcasts') }}{{ base_q }}{{ '&' if base_q else '?' }}page={{ last_page }}" style="text-decoration:none; font-size:.65rem; font-weight:800; letter-spacing:.5px; padding:.55rem .9rem .5rem; background:#f1edff; border:1px solid #e2d6f9; color:#6233B5; border-radius:18px;">√öltima ¬ª</a>
                {% endif %}
            {% endif %}
        </div>
    </main>
    <footer>
        ¬© 2025 Gram√°tike ‚Ä¢ Inclus√£o e G√™nero Neutro
    </footer>
    <script>
    (function(){
        const list = document.querySelector('.podcast-list');
        if(!list) return;
        list.addEventListener('click', e => {
            const trig = e.target.closest('.item-menu-trigger');
            if(trig){
                e.preventDefault();
                const item = trig.closest('.podcast-item');
                const menu = item.querySelector('.item-menu');
                const open = menu.classList.contains('show');
                document.querySelectorAll('.item-menu.show').forEach(m=>m.classList.remove('show'));
                if(!open) menu.classList.add('show');
            }
        });
        document.addEventListener('click', e => { if(!e.target.closest('.podcast-item')) document.querySelectorAll('.item-menu.show').forEach(m=>m.classList.remove('show')); });
    })();
    </script>
</body>
</html>