<!DOCTYPE html>
<html lang="pt-BR">
<head>
<style>
:root { --font-base: 'Nunito', system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif; --font-brand: 'Mansalva', cursive; }
body, p, label, input, button, a, span, li, td, th, div, h1, h2, h3, h4, h5, h6 { font-family: var(--font-base) !important; }
</style>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gram√°tike ‚Äî Perfil</title>
  <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
  <link rel="icon" type="image/png" href="/static/favicon.png">
  <link rel="apple-touch-icon" href="/static/img/icons/icon-192.png">
  <link rel="stylesheet" href="/static/gramatike_common.css">
  <link href="https://fonts.googleapis.com/css2?family=Mansalva&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
  .btn { display:inline-flex; align-items:center; justify-content:center; gap:.4rem; padding:.6rem 1rem; border-radius:10px; border:none; cursor:pointer; font-family:'Nunito'; font-weight:700; letter-spacing:.3px; transition:filter .15s ease, transform .05s ease; }
  .btn:active { transform: translateY(1px); }
  .btn-primary { background:#9B5DE5; color:#fff; }
  .btn-primary:hover { filter:brightness(1.08); }
    body, p, label, input, button, a, span, li, td, th, div, h1, h2, h3, h4, h5, h6 {
      font-family: 'Nunito', system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif !important;
    }
    :root {
      --primary: #9b5de5;
      --secondary: #f0f4f8;
      --success: #a5d6a7;
      --danger: #9b5de5;
      --text: #333;
      --text-secondary: #666;
    }

    html, body { height:100%; overflow-x:hidden; }
    body {
      margin: 0;
      padding: 0;
      background-color: var(--secondary);
      color: var(--text);
      display:flex;
      flex-direction:column;
      min-height:100vh;
    }

  header.site-head { background:#9B5DE5; padding:18px clamp(16px,4vw,40px) 28px; border-bottom-left-radius:35px; border-bottom-right-radius:35px; position:relative; display:flex; flex-direction:column; align-items:center; }
    /* Mobile: Header mais compacto */
    @media (max-width: 900px){ 
      header.site-head { padding:12px clamp(12px,3vw,20px) 18px; }
      .logo { font-size:1.8rem !important; }
    }
    .logo { font-family: var(--font-brand) !important; font-size:2.5rem; color:#fff; letter-spacing:1px; font-weight:400; }
  /* Avatar do usu√°rio no cabe√ßalho - movido para cima */
  .profile-avatar-link { position:absolute; right:24px; top:38%; transform:translateY(-50%); display:inline-flex; align-items:center; justify-content:center; width:58px; height:58px; border-radius:50%; border:3px solid #ffffff55; box-shadow:0 4px 14px rgba(0,0,0,.25); overflow:hidden; background:#ffffff22; backdrop-filter:blur(4px); -webkit-backdrop-filter:blur(4px); cursor:pointer; text-decoration:none; transition: box-shadow .25s, transform .18s; }
  .profile-avatar-link:hover { box-shadow:0 6px 20px rgba(0,0,0,.32); }
  .profile-avatar-link:active { transform:translateY(-50%) scale(.95); }
  .profile-avatar-link img { width:100%; height:100%; object-fit:cover; display:block; }
  .profile-avatar-link span.initial { font-size:1.9rem; font-weight:800; color:#fff; letter-spacing:.5px; }
  /* Tooltip simples acess√≠vel */
  .profile-avatar-link[data-tooltip]:hover::after, .profile-avatar-link[data-tooltip]:focus-visible::after { content:attr(data-tooltip); position:absolute; bottom:-6px; left:50%; transform:translate(-50%,100%); background:#222; color:#fff; font-size:.6rem; font-weight:600; padding:4px 7px 5px; border-radius:8px; white-space:nowrap; box-shadow:0 4px 12px rgba(0,0,0,.35); letter-spacing:.5px; }
  @media (max-width:640px){ .profile-avatar-link { width:46px; height:46px; right:16px; } .profile-avatar-link span.initial { font-size:1.4rem; } }
    .head-actions { position:absolute; right:16px; top:38%; transform:translateY(-50%); display:flex; gap:.5rem; }
    .icon-btn { width:40px; height:40px; border-radius:12px; display:inline-flex; align-items:center; justify-content:center; background:#ffffff22; border:1px solid #ffffff44; color:#fff; text-decoration:none; font-size:18px; font-weight:700; box-shadow:0 4px 14px rgba(0,0,0,.25); }
    .icon-btn:hover { background:#ffffff33; }

    nav a {
      margin-left: 1rem;
      text-decoration: none;
      color: var(--text);
      font-weight: 500;
    }

    nav a:hover {
      color: var(--primary);
    }

    main {
      max-width: none;
      margin: 2rem 0;
      padding: 0 24px;
      flex:1 0 auto;
    }

    .profile-header {
      background: white;
      border-radius: 8px;
      padding: 2rem;
      display: flex;
      align-items: center;
      gap: 1.5rem;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      width: 50%;
      margin-left: auto;
      margin-right: auto;
    }

    .avatar {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: var(--secondary);
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 3rem;
      color: var(--primary);
    }

    .profile-info h2 {
      margin: 0;
  font-family: 'Nunito';
      font-weight:600;
      letter-spacing:.5px;
      font-size:1.4rem;
      color:#333;
    }

    .profile-info p {
      margin: 0.3rem 0;
      color: var(--text-secondary);
    }

    .edit-btn {
      background: var(--primary);
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 0.5rem;
    }

    .edit-btn:hover {
      background: #3b5a85;
    }

    .tabs {
      display: flex;
      gap: 1rem;
      margin-top: 2rem;
      border-bottom: 2px solid #ddd;
      width: 50%;
      margin-left: auto;
      margin-right: auto;
    }

    .tab {
      padding: 0.5rem 1rem;
      cursor: pointer;
      font-weight: 500;
      color: var(--text-secondary);
    }

    .tab.active {
      color: var(--primary);
      border-bottom: 3px solid var(--primary);
    }

    .tab-content {
      background: white;
      padding: 1.5rem;
      margin-top: 1rem;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      width: 50%;
      margin-left: auto;
      margin-right: auto;
    }

    /* Post action buttons - matching index.html */
    .post-actions { display:flex; gap:1.2rem; }
    .post-actions button { cursor:pointer; border:none; border-radius:28px; padding:.45rem .9rem; font-weight:600; font-size:.8rem; display:flex; align-items:center; gap:.35rem; transition: background-color .2s, transform .15s; }
    .post-actions button:active { transform: translateY(1px); }
    .likes-list { margin-bottom:.9rem; font-size:.9rem; color: var(--text-secondary); font-weight:500; }
    .like-btn-perfil { background:#ede7ff; color: #9B5DE5; box-shadow: 0 4px 10px rgba(130,87,229,0.25); border:1px solid #d3c5ff; border-radius:28px; padding:.45rem .9rem; font-weight:600; font-size:.8rem; }
    .like-btn-perfil:hover, .like-btn-perfil.liked { background: #9B5DE5; color:#fff; box-shadow: 0 6px 16px rgba(130,87,229,0.45); border-color: #9B5DE5; }
    .comment-btn-perfil { background: #9B5DE5; color:#fff; box-shadow: 0 5px 15px rgba(130,87,229,0.6); border-radius:28px; padding:.45rem .9rem; font-weight:600; font-size:.8rem; }
    .comment-btn-perfil:hover { background: #7d3dc9; box-shadow: 0 8px 25px rgba(111,72,201,0.9); }
    .toggle-comments-btn-perfil { background:#f1edff; color:#9B5DE5; border:1px solid #d8ccff; padding:.45rem 1rem; font-size:.7rem; font-weight:700; border-radius:40px; cursor:pointer; letter-spacing:.5px; box-shadow:0 2px 6px rgba(0,0,0,.06); }
    .toggle-comments-btn-perfil:hover { background:#9B5DE5; color:#fff; border-color:#9B5DE5; }

    @media (max-width: 900px) {
      .profile-header, .tabs, .tab-content { 
        width: 100%; 
        max-width: 100%;
        padding: 1.2rem; 
        box-sizing: border-box;
      }
      .profile-header { 
        flex-direction: column; 
        text-align: center;
        overflow-wrap: break-word;
        word-wrap: break-word;
      }
      .avatar { width: 80px; height: 80px; font-size: 2rem; }
      .profile-info h2 { 
        font-size: 1.1rem;
        max-width: 100%;
        overflow-wrap: break-word;
        word-break: break-word;
      }
      main { 
        padding: 0 12px; 
        margin: 1rem 0;
        max-width: 100vw;
        overflow-x: hidden;
      }
    }

    .post {
      border-bottom: 1px solid #eee;
      padding: 1rem 0;
      max-width: 100%;
      overflow-wrap: break-word;
      word-wrap: break-word;
    }

    .post:last-child {
      border-bottom: none;
    }

    footer {
      text-align: center;
      padding: 1rem;
      margin-top: auto;
      color: var(--text-secondary);
    }
    
    /* Barra de navega√ß√£o inferior mobile */
    .mobile-bottom-nav {
      display: none;
      position: fixed;
      bottom: 12px;
      left: 12px;
      right: 12px;
      background: #9B5DE5;
      border-radius: 24px;
      padding: 10px 8px calc(10px + env(safe-area-inset-bottom));
      box-shadow: 0 4px 20px rgba(155, 93, 229, 0.4);
      z-index: 1000;
    }
    
    @media (max-width: 980px){ 
      .mobile-bottom-nav {
        display: flex;
        justify-content: space-around;
        align-items: center;
      }
      
      /* Ocultar o cabe√ßalho em mobile */
      header.site-head {
        display: none !important;
      }
      
      footer { 
        display:none !important; 
      }
      
      main {
        padding: 0 12px !important;
        margin-bottom: calc(80px + env(safe-area-inset-bottom)) !important;
      }
      
      .profile-header {
        width: 100% !important;
        flex-direction: column !important;
        text-align: center !important;
        padding: 1.5rem 1rem !important;
        overflow-wrap: break-word !important;
        word-wrap: break-word !important;
      }
      
      .profile-info {
        align-items: center !important;
        max-width: 100% !important;
        overflow-wrap: break-word !important;
      }
      
      .profile-info h2,
      .profile-info p {
        max-width: 100% !important;
        overflow-wrap: break-word !important;
        word-break: break-word !important;
      }
      
      /* Fix stats display on mobile - keep side by side */
      .profile-info > div:first-of-type {
        display: flex !important;
        flex-direction: row !important;
        gap: 0.8rem !important;
        font-size: 0.85rem !important;
        flex-wrap: nowrap !important;
        justify-content: center !important;
      }
      
      .profile-actions {
        width: 100% !important;
        flex-direction: column !important;
      }
      
      .profile-actions button,
      .profile-actions .btn {
        width: 100% !important;
      }
      
      .profile-content {
        width: 100% !important;
        padding: 0 !important;
      }
      
      .tabs {
        flex-wrap: wrap !important;
        gap: 0.3rem !important;
        width: 100% !important;
        justify-content: center !important;
      }
      
      .tabs button {
        flex: 0 1 auto !important;
        min-width: 30% !important;
        font-size: 0.7rem !important;
        padding: 0.5rem 0.6rem !important;
        text-align: center !important;
      }
      
      .tab-content {
        width: 100% !important;
        padding: 0.8rem !important;
        overflow-wrap: break-word !important;
      }
      
      /* Fix post overflow on mobile */
      .post {
        max-width: 100% !important;
        overflow-wrap: break-word !important;
        word-wrap: break-word !important;
      }
      
      .post p, .post strong, .post span {
        max-width: 100% !important;
        overflow-wrap: break-word !important;
        word-break: break-word !important;
      }
      
      /* Fix post menu positioning on mobile */
      .post-menu {
        right: 0 !important;
        left: auto !important;
      }
      
      /* Hide back button on mobile */
      .back-btn {
        display: none !important;
      }
    }

    /* Estilos para o modal de edi√ß√£o */
    #modal-editar {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
  overflow-y:auto; /* permite rolar quando o conte√∫do exceder a altura */
  padding: 1.5rem 1rem; /* espa√ßo para n√£o colar nas bordas em mobile */
    }

    #form-editar-perfil {
      background: white;
      padding: 2rem;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      width: 90%;
      max-width: 500px;
  max-height: 90vh; /* limita altura para caber na viewport */
  overflow-y:auto;  /* rolagem interna se necess√°rio */
    }

    #form-editar-perfil label {
      display: block;
      margin-bottom: 1rem;
      color: var(--text);
    }

    #form-editar-perfil input {
      width: 100%;
      padding: 0.5rem;
      margin-top: 0.5rem;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    #form-editar-perfil button {
      margin-top: 1rem;
    }
    
    .mobile-bottom-nav a {
      all: unset;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 4px;
      padding: 6px 12px;
      cursor: pointer;
      color: #ffffff;
      font-size: 0.65rem;
      font-weight: 600;
      letter-spacing: 0.3px;
      transition: opacity 0.2s;
      text-decoration: none;
    }

    .mobile-bottom-nav a:active {
      transform: scale(0.95);
    }

    .mobile-bottom-nav a svg {
      color: #ffffff;
      transition: opacity 0.2s;
    }

    .mobile-bottom-nav a:hover {
      opacity: 0.85;
    }

    .mobile-bottom-nav a:hover svg {
      opacity: 0.85;
    }

    /* Post media styles for images with cover (Twitter-style) */
    .post-media img { width:100%; max-width:100%; display:block; border-radius:24px; margin:.6rem 0 1.1rem; object-fit:contain; background:#f3f4f6; max-height:380px; cursor:pointer; }
    .post-media { position:relative; overflow:hidden; max-width:100%; }
    .post-media.multi { display:grid; gap:8px; margin:.6rem 0 1.1rem; max-width:100%; }
    .post-media.multi.grid-2 { grid-template-columns:repeat(2,1fr); }
    .post-media.multi.grid-3 { grid-template-columns:repeat(3,1fr); }
    .post-media.multi.grid-4 { grid-template-columns:repeat(2,1fr); }
    .post-media.multi .pm-item img { margin:0; height:180px; border-radius:16px; object-fit:contain; background:#f3f4f6; cursor:pointer; width:100%; max-width:100%; }
    
    @media (max-width: 900px) {
      .post-media img { border-radius:16px; max-height:280px; }
      .post-media.multi .pm-item img { height:140px; }
    }
  </style>
</head>
<body>
  <header class="site-head">
    <h1 class="logo">Gram√°tike</h1>
    <div class="head-actions">
      <a href="javascript:history.back()" class="icon-btn back-btn" title="Voltar" aria-label="Voltar">‚¨ÖÔ∏è</a>
      <a href="/configuracoes" class="icon-btn" title="Configura√ß√µes" aria-label="Configura√ß√µes">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <circle cx="12" cy="12" r="3"></circle>
          <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
        </svg>
      </a>
    </div>
  </header>


  <main>
    
    <section class="profile-header">
      <div class="avatar">
        
          
          
          
          <img src="<!-- VAR_PLACEHOLDER -->" alt="Foto de perfil" style="width:100%;height:100%;object-fit:cover;border-radius:50%;">
        
          <span>üë§</span>
        
      </div>
      <div class="profile-info">
  <h2 style="font-family: var(--font-brand); font-weight:400; letter-spacing:1px;">@<!-- USER_username --></h2>
        <div style="display:flex;gap:1rem;margin-bottom:0.7rem;flex-wrap:nowrap;justify-content:center;">
          <span id="cnt-seguidores" style="white-space:nowrap;"><b>0</b> seguidories</span>
          <span id="cnt-seguindo" style="white-space:nowrap;"><b>0</b> seguindo</span>
        </div>
        <p><strong></strong> <span style="color:#666"><!-- VAR_PLACEHOLDER --></span></p>
  {# Exibir g√™nero/pronome somente se n√£o for 'Outro' #}
  
  
  
  <p><strong></strong> <span style="color:#666"><!-- VAR_PLACEHOLDER --> / <!-- VAR_PLACEHOLDER --></span></p>
  
  
  <p style="margin-top:0.5rem;color:#444;font-style:italic;white-space:pre-line;"><!-- USER_bio --></p>
  
        <button class="edit-btn" onclick="abrirEdicaoPerfil()">Editar Perfil</button>
      </div>
    </section>

    <div class="tabs">
      <div class="tab active" onclick="mostrarAba('postagens')">Postagens</div>
  <div class="tab" onclick="mostrarAba('seguidores')">Seguidories</div>
      <div class="tab" onclick="mostrarAba('seguindo')">Seguindo</div>
    </div>

    <div id="tab-content" class="tab-content">
      <div id="postagens">
        <p>Carregando postagens...</p>
      </div>
    </div>

    <!-- Modal para edi√ß√£o de perfil -->
    <div id="modal-editar" style="display:none;">
      <form id="form-editar-perfil" enctype="multipart/form-data">
        <input type="hidden" name="csrf_token" value="" />
        <div style="display: flex; flex-direction: column; gap: 0.7rem;">
          <label style="margin-bottom:0.3rem;">Usu√°rie:
            <input type="text" name="username" value="<!-- USER_username -->" readonly style="width:100%;">
          </label>
          <label style="margin-bottom:0.3rem;">Nome:
            <input type="text" name="nome" value="<!-- VAR_PLACEHOLDER -->" style="width:100%;">
          </label>
          <label style="margin-bottom:0.3rem;">Email:
            <input type="email" name="email" value="<!-- USER_email -->" style="width:100%;">
          </label>
          <label id="bio-field" style="margin-bottom:0.3rem;">Bio:
            <textarea name="bio" style="width:100%;resize:vertical;min-height:40px;"><!-- VAR_PLACEHOLDER --></textarea>
          </label>
          <label style="margin-bottom:0.3rem;">Data de nascimento:
            <input type="date" name="data_nascimento" value="<!-- VAR_PLACEHOLDER -->" style="width:100%;">
          </label>
          <label style="margin-bottom:0.3rem;">G√™nero:
            <select name="genero" required style="width:100%;" id="genero-select">
              <option value="">Selecione</option>
              <option value="N√£o-bin√°rie" selected>N√£o-bin√°rie</option>
              <option value="Mulher" selected>Mulher</option>
              <option value="Homem" selected>Homem</option>
              <option value="Outro" selected>Outro</option>
            </select>
          </label>
          <label style="margin-bottom:0.3rem;">Pronome:
            <select name="pronome" required style="width:100%;" id="pronome-select">
              <option value="">Selecione</option>
              <option value="elu/delu" selected>elu/delu</option>
              <option value="ela/dela" selected>ela/dela</option>
              <option value="ele/dele" selected>ele/dele</option>
              <option value="Outro" selected>Outro</option>
            </select>
          </label>
          <label style="margin-bottom:0.3rem;">Foto de perfil:
            <input type="file" name="foto_perfil" accept="image/*" style="width:100%;">
          </label>
          <div style="display:flex;gap:0.5rem;">
            <button type="submit" class="btn btn-primary" style="flex:1;">Salvar</button>
            <button type="button" class="btn btn-primary" onclick="fecharEdicaoPerfil()" style="flex:1;">Cancelar</button>
          </div>
        </div>
      </form>
    </div>
  <!-- CONTENT_PLACEHOLDER -->
</main>

  <footer>
  ¬© 2025 Gram√°tike ‚Ä¢ Linguagem Viva e de Todes
  </footer>

  <script>
    window.USER_ID = "<!-- VAR_PLACEHOLDER -->";
  </script>
  <script>
    // Renderiza imagens (uma ou m√∫ltiplas) separadas por '|'
    function renderPostImages(raw){
      if(!raw) return '';
      const parts = raw.split('|').filter(Boolean);
      if(!parts.length) return '';
      // Helper: determinar src correto (URL ou path local)
      const getSrc = (path) => /^https?:\/\//i.test(path) ? path : `/static/${path}`;
      // Melhor tratamento de erro: mostra placeholder ao inv√©s de esconder
      const onError = `this.onerror=null; this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22400%22 height=%22300%22%3E%3Crect fill=%22%23f3f4f6%22 width=%22400%22 height=%22300%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 font-family=%22Arial,sans-serif%22 font-size=%2214%22 fill=%22%23999%22%3EImagem n√£o dispon√≠vel%3C/text%3E%3C/svg%3E'; this.style.cursor='default'; this.onclick=null; console.warn('Imagem falhou ao carregar:', this.getAttribute('data-original-src'));`;
      
      if(parts.length === 1){
        const src = getSrc(parts[0]);
        return `<div class="post-media"><img src="${src}" alt="Imagem do post" data-original-src="${src}" onclick="openImageModal('${src}')" onerror="${onError}"/></div>`;
      }
      // Grid simples para m√∫ltiplas
      const cls = parts.length===2? 'grid-2' : (parts.length===3? 'grid-3':'grid-4');
      const imgs = parts.map(p=>{
        const src = getSrc(p);
        return `<div class="pm-item"><img src="${src}" alt="Imagem do post" data-original-src="${src}" onclick="openImageModal('${src}')" onerror="${onError}"/></div>`;
      }).join('');
      return `<div class="post-media multi ${cls}">${imgs}</div>`;
    }

    function mostrarAba(aba) {
      const tabs = document.querySelectorAll('.tab');
      tabs.forEach(t => t.classList.remove('active'));
      event.target.classList.add('active');

      if (aba === 'postagens') {
        carregarPostagensUsuario();
      } else if (aba === 'seguidores') {
        fetch(`/api/seguidores/${window.USER_ID}`)
          .then(res => res.json())
          .then(lista => {
            let html = '<b>Seguidories</b><div style="margin-top:0.7rem;display:flex;flex-direction:column;gap:.35rem;">';
            if (lista.length === 0) html += '<div style="color:#666;font-size:.85rem;">Nenhume seguidore ainda.</div>';
            else html += lista.map(u => `
              <div class="seg-item" data-username="${u.username}" style="display:flex;align-items:center;gap:.55rem;cursor:pointer;padding:.35rem .5rem;border:1px solid #eee;border-radius:6px;background:#fafafa;">
                <div style="width:32px;height:32px;border-radius:50%;background:#4a6fa522;display:flex;align-items:center;justify-content:center;font-weight:600;color:#4a6fa5;">${u.username.charAt(0).toUpperCase()}</div>
                <div style="display:flex;flex-direction:column;line-height:1.1;">
                  <span style="font-weight:600;color:#333;">@${u.username}</span>
                  ${u.nome ? `<span style='font-size:.65rem;color:#777;'>${u.nome}</span>` : ''}
                </div>
              </div>`).join('');
            html += '</div>';
            document.getElementById('tab-content').innerHTML = html;
          });
      } else if (aba === 'seguindo') {
        fetch(`/api/seguindo/${window.USER_ID}`)
          .then(res => res.json())
          .then(lista => {
            let html = '<b>Seguindo</b><div style="margin-top:0.7rem;display:flex;flex-direction:column;gap:.35rem;">';
            if (lista.length === 0) html += '<div style="color:#666;font-size:.85rem;">Voc√™ n√£o est√° seguindo ningu√©m ainda.</div>';
            else html += lista.map(u => `
              <div class="seg-item" data-username="${u.username}" style="display:flex;align-items:center;gap:.55rem;cursor:pointer;padding:.35rem .5rem;border:1px solid #eee;border-radius:6px;background:#fafafa;">
                <div style="width:32px;height:32px;border-radius:50%;background:#4a6fa522;display:flex;align-items:center;justify-content:center;font-weight:600;color:#4a6fa5;">${u.username.charAt(0).toUpperCase()}</div>
                <div style="display:flex;flex-direction:column;line-height:1.1;">
                  <span style="font-weight:600;color:#333;">@${u.username}</span>
                  ${u.nome ? `<span style='font-size:.65rem;color:#777;'>${u.nome}</span>` : ''}
                </div>
              </div>`).join('');
            html += '</div>';
            document.getElementById('tab-content').innerHTML = html;
          });
      }
    }

  // Atualiza contadores de seguidories/seguindo (escopo global)
    function atualizarContadores() {
      // Postagens counter removed as per user request
      fetch(`/api/seguidores/${window.USER_ID}`)
        .then(res => res.json())
        .then(lista => {
          const el = document.getElementById('cnt-seguidores');
          if(el) el.innerHTML = `<b>${lista.length}</b> seguidories`;
        });
      fetch(`/api/seguindo/${window.USER_ID}`)
        .then(res => res.json())
        .then(lista => {
          const el = document.getElementById('cnt-seguindo');
          if(el) el.innerHTML = `<b>${lista.length}</b> seguindo`;
        });
    }

    function carregarPostagensUsuario() {
      fetch('/api/posts/me')
        .then(response => response.json())
        .then(posts => {
          let conteudo = '';
          if (posts.length === 0) {
            conteudo = '<p>Nenhuma postagem encontrada.</p>';
          } else {
            conteudo = posts.map(post => `
              <div class="post" data-post-id="${post.id}" style="position:relative;">
                <div class="post-header" style="display:flex;align-items:center;justify-content:space-between;">
                  <div style="display:flex;align-items:center;gap:0.7rem;">
                    <img src="${(post.foto_perfil && (post.foto_perfil.startsWith('http://') || post.foto_perfil.startsWith('https://'))) ? post.foto_perfil : ('/static/' + (post.foto_perfil || 'img/perfil.png'))}" alt="Foto de perfil" class="post-avatar" style="width:40px;height:40px;border-radius:50%;object-fit:cover;border:2px solid #eee;cursor:pointer;">
                    <span style="cursor:pointer;" class="post-username"><strong>@${post.usuario}</strong> <span style="color:#888;">${post.data}</span></span>
                  </div>
                  <div class="post-menu-container" style="position:relative;">
                    <button class="post-menu-btn" aria-label="A√ß√µes" style="background:none;border:none;cursor:pointer;font-size:1.3rem;line-height:1;color:#555;">‚ãØ</button>
                    <div class="post-menu" style="display:none; position:absolute; top:28px; right:0; background:#fff; border:1px solid #ddd; border-radius:8px; padding:.35rem 0; box-shadow:0 4px 12px rgba(0,0,0,.15); z-index:30; min-width:140px;">
                      <button class="pm-excluir" style="display:block;width:100%;background:none;border:none;text-align:left;padding:.5rem .9rem;font-size:.7rem;cursor:pointer;">Excluir</button>
                      <button class="pm-compartilhar" style="display:block;width:100%;background:none;border:none;text-align:left;padding:.5rem .9rem;font-size:.7rem;cursor:pointer;">Compartilhar</button>
                    </div>
                  </div>
                </div>
                <p style="white-space:pre-line;">${post.conteudo}</p>
                ${ (post.images && post.images.length) ? renderPostImages(post.images.join('|')) : (post.imagem ? renderPostImages(post.imagem) : '') }
                <div class='likes-list' style='font-size:.9rem;margin:.4rem 0;'></div>
                <div class='post-actions'>
                  <button class='like-btn-perfil ${post.liked ? 'liked' : ''}' data-post-id='${post.id}'>${post.liked ? '<svg width="16" height="16" viewBox="0 0 24 24" fill="#9B5DE5" stroke="#9B5DE5" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg> Curtido' : '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#9B5DE5" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg> Curtir'}</button>
                  <button class='comment-btn-perfil' data-post-id='${post.id}'><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg> Comentar</button>
                  <button class='toggle-comments-btn-perfil' data-post-id='${post.id}'>‚Üì</button>
                </div>
                <div class='comments-list' data-post-id='${post.id}' style='display:none;margin-top:.6rem;'></div>
              </div>
            `).join('');
          }
          document.getElementById('tab-content').innerHTML = `<div id="postagens">${conteudo}</div>`;
          inicializarMenusPosts();
          atualizarContadores();
        })
        .catch(() => {
          document.getElementById('tab-content').innerHTML = '<p>Erro ao carregar postagens.</p>';
        });
    }

    function inicializarMenusPosts(){
      // Abrir/fechar menus
      document.querySelectorAll('.post-menu-btn').forEach(btn=>{
        btn.addEventListener('click', e=>{
          e.stopPropagation();
          const menu = btn.parentElement.querySelector('.post-menu');
            const open = menu.style.display==='block';
            document.querySelectorAll('.post-menu').forEach(m=>m.style.display='none');
            menu.style.display = open ? 'none':'block';
        });
      });
      document.addEventListener('click', ()=>{
        document.querySelectorAll('.post-menu').forEach(m=>m.style.display='none');
      });
      // Excluir
      document.querySelectorAll('.pm-excluir').forEach(btn=>{
        btn.addEventListener('click', e=>{
          e.stopPropagation();
          const postDiv = btn.closest('.post');
          const id = postDiv.getAttribute('data-post-id');
          if(confirm('Excluir este post?')){
            fetch(`/api/posts/${id}`, { method:'DELETE' }).then(r=>{
              if(r.ok){ postDiv.remove(); }
            });
          }
        });
      });
      // Compartilhar
      document.querySelectorAll('.pm-compartilhar').forEach(btn=>{
        btn.addEventListener('click', e=>{
          e.stopPropagation();
          const postDiv = btn.closest('.post');
          const id = postDiv.getAttribute('data-post-id');
          const shareUrl = window.location.origin + '/perfil#post-' + id;
          navigator.clipboard.writeText(shareUrl).then(()=>{
            alert('Link copiado.');
          });
        });
      });

      // Like button functionality
      document.querySelectorAll('.like-btn-perfil').forEach(btn=>{
        btn.addEventListener('click', e=>{
          e.stopPropagation();
          const postId = btn.getAttribute('data-post-id');
          fetch(`/api/posts/${postId}/like`, { method: 'POST' })
            .then(res => res.json())
            .then(data => {
              if (data.liked) {
                btn.classList.add('liked');
                btn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="#9B5DE5" stroke="#9B5DE5" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg> Curtido';
              } else {
                btn.classList.remove('liked');
                btn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#9B5DE5" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg> Curtir';
              }
              updateLikesDisplayPerfil(postId, btn.closest('.post'));
            });
        });
      });

      // Comment button functionality
      document.querySelectorAll('.comment-btn-perfil').forEach(btn=>{
        btn.addEventListener('click', e=>{
          e.stopPropagation();
          showCommentBoxPerfil(btn);
        });
      });

      // Toggle comments button functionality
      document.querySelectorAll('.toggle-comments-btn-perfil').forEach(btn=>{
        btn.addEventListener('click', e=>{
          e.stopPropagation();
          const postId = btn.getAttribute('data-post-id');
          toggleCommentsPerfil(btn, postId);
        });
      });

      // Load likes for each post
      document.querySelectorAll('.post').forEach(post=>{
        const postId = post.getAttribute('data-post-id');
        updateLikesDisplayPerfil(postId, post);
      });
    }

    function updateLikesDisplayPerfil(postId, postElem) {
      fetch(`/api/posts/${postId}/likes`)
        .then(res => res.json())
        .then(users => {
          let likesDiv = postElem.querySelector('.likes-list');
          if (!likesDiv) {
            likesDiv = document.createElement('div');
            likesDiv.className = 'likes-list';
            likesDiv.style.cssText = 'font-size:.7rem;margin:.4rem 0;';
            const actionsDiv = postElem.querySelector('.like-btn-perfil').parentElement;
            postElem.insertBefore(likesDiv, actionsDiv);
          }
          if (users.length === 0) {
            likesDiv.innerHTML = '';
          } else {
            const currentUser = '<!-- USER_username -->';
            const curtiu = users.includes(currentUser);
            likesDiv.innerHTML = `<span style="color:#666;">`+
              (curtiu ? '<strong style="color:#7c3aed;">Voc√™</strong>' : '') +
              (curtiu && users.length > 1 ? ' e ' : '') +
              users.filter(u => u !== currentUser).slice(0, 2).join(', ') +
              (users.length > 3 ? ` e mais ${users.length - 3}` : '') +
              ' curtiram</span>';
          }
        });
    }

    function showCommentBoxPerfil(btn) {
      const postElem = btn.closest('.post');
      let box = postElem.querySelector('.comment-box');
      if (!box) {
        box = document.createElement('div');
        box.className = 'comment-box';
        box.style.cssText = 'margin-top:.6rem;display:flex;gap:.5rem;flex-direction:column;';
        box.innerHTML = `
          <textarea class="comment-input" placeholder="Escreva um coment√°rio..." style="border:1px solid #ddd;border-radius:8px;padding:.6rem;font-size:.75rem;resize:vertical;min-height:60px;"></textarea>
          <button onclick="submitCommentPerfil(this)" style="align-self:flex-end;background:#9B5DE5;color:#fff;border:none;border-radius:6px;padding:.4rem .8rem;font-size:.75rem;cursor:pointer;">Enviar</button>
        `;
        postElem.appendChild(box);
      } else {
        box.remove();
      }
    }

    function submitCommentPerfil(btn) {
      const textarea = btn.parentElement.querySelector('.comment-input');
      if(!textarea) return;
      const postElem = btn.closest('.post');
      const postId = postElem.getAttribute('data-post-id');
      const val = textarea.value.trim();
      if(!val) return;
      fetch(`/api/posts/${postId}/comentarios`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({conteudo: val})
      }).then(() => {
        textarea.value = '';
        const commentBox = btn.closest('.comment-box');
        if(commentBox) commentBox.remove();
        const list = postElem.querySelector('.comments-list');
        const toggleBtn = postElem.querySelector('.toggle-comments-btn-perfil');
        if(list && list.style.display !== 'none') {
          loadCommentsPerfil(postId, postElem).then(count=>{
            if(toggleBtn) toggleBtn.textContent = count ? `‚Üë ${count}` : '‚Üë';
          });
        } else {
          loadCommentsPerfil(postId, postElem, true).then(count=>{
            if(toggleBtn) toggleBtn.textContent = count ? `‚Üì ${count}` : '‚Üì';
          });
        }
      });
    }

    function toggleCommentsPerfil(btn, postId) {
      const postElem = btn.closest('.post');
      const commentsDiv = postElem.querySelector('.comments-list');
      if (commentsDiv.style.display === 'none') {
        loadCommentsPerfil(postId, postElem).then(count => {
          commentsDiv.style.display = 'block';
          btn.textContent = count ? `‚Üë ${count}` : '‚Üë';
        });
      } else {
        commentsDiv.style.display = 'none';
        btn.textContent = '‚Üì';
      }
    }

    function loadCommentsPerfil(postId, postElem, silent=false) {
      return fetch(`/api/posts/${postId}/comentarios`)
        .then(res => res.json())
        .then(comments => {
          let commentsDiv = postElem.querySelector('.comments-list');
          if (!commentsDiv) {
            commentsDiv = document.createElement('div');
            commentsDiv.className = 'comments-list';
            commentsDiv.setAttribute('data-post-id', postId);
            commentsDiv.style.cssText = 'display:none;margin-top:.6rem;';
            postElem.appendChild(commentsDiv);
          }
          if(!Array.isArray(comments)) comments = [];
          if(comments.length === 0){
            commentsDiv.innerHTML = '<div style="font-size:.7rem;color:#888;padding:.4rem 0;">Nenhum coment√°rio ainda.</div>';
          } else {
            commentsDiv.innerHTML = comments.map(c =>
              `<div style="padding:.5rem;border-left:2px solid #eee;margin-bottom:.4rem;">
                <div style="font-size:.7rem;"><strong>@${c.usuario}</strong> <span style="color:#888;">${(c.data||'').replace(' ',' ¬∑ ')}</span></div>
                <p style="font-size:.7rem;margin:.2rem 0 0;white-space:pre-line;">${c.conteudo}</p>
              </div>`
            ).join('');
          }
          return comments.length;
        });
    }

    function abrirEdicaoPerfil() {
      document.getElementById('modal-editar').style.display = 'flex';
      toggleBioField();
    }

    function fecharEdicaoPerfil() {
      document.getElementById('modal-editar').style.display = 'none';
    }

    document.addEventListener('DOMContentLoaded', function() {
    function toggleBioField(){
      const g = document.getElementById('genero-select');
      const p = document.getElementById('pronome-select');
      const bio = document.getElementById('bio-field');
      if(!g || !p || !bio) return;
      const hide = (g.value === 'Outro' && p.value === 'Outro');
      bio.style.display = hide ? 'none' : '';
    }
    const gSel = document.getElementById('genero-select');
    const pSel = document.getElementById('pronome-select');
    if(gSel) gSel.addEventListener('change', toggleBioField);
    if(pSel) pSel.addEventListener('change', toggleBioField);
    toggleBioField();
    // Passar o id do usu√°rio para o JS de forma segura
    window.USER_ID = "<!-- VAR_PLACEHOLDER -->";
    document.getElementById('form-editar-perfil').onsubmit = function(event) {
      event.preventDefault();
      const formData = new FormData(this);
      fetch('/api/editar-perfil', {
        method: 'POST',
        body: formData
      }).then(async response => {
        if (response.ok) {
          alert('Perfil atualizado com sucesso!');
          location.reload();
        } else {
          let msg = 'Erro ao atualizar perfil.';
          try {
            const data = await response.json();
            if (data && (data.erro || data.error)) {
              msg = 'Erro ao atualizar perfil: ' + (data.erro || data.error);
            }
          } catch (e) {}
          alert(msg);
        }
      });
    };
  carregarPostagensUsuario(); // Carrega as postagens ao abrir a p√°gina
  atualizarContadores(); // Atualiza contadores ao abrir a p√°gina
    });

    // Delega√ß√£o para clique em itens de seguidores/seguindo
    document.addEventListener('click', function(e){
      const seg = e.target.closest('.seg-item');
      if(seg){
        const uname = seg.getAttribute('data-username');
        if(uname === '<!-- USER_username -->'){
          window.location.href = '/perfil';
        } else {
          fetch(`/api/usuarios/username/${uname}`).then(r=>r.json()).then(u=>{ if(u.id) window.location.href = '/perfil/'+u.id; });
        }
      }
    });

    function seguirOuDeixar(usuarioId, seguir) {
      fetch(`/api/seguir/${usuarioId}`, {
        method: seguir ? 'POST' : 'DELETE'
      }).then(() => location.reload());
    }

    // Image Modal for full-size view
    function ensureImageModal() {
      if(document.getElementById('image-modal')) return;
      const modal = document.createElement('div');
      modal.id = 'image-modal';
      modal.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,0.9);display:none;align-items:center;justify-content:center;z-index:2000;';
      modal.innerHTML = `<div style="position:relative;max-width:95vw;max-height:95vh;display:flex;align-items:center;justify-content:center;">
        <button onclick="closeImageModal()" style="position:absolute;top:10px;right:10px;background:rgba(255,255,255,0.9);border:none;border-radius:50%;width:40px;height:40px;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 10px rgba(0,0,0,0.3);z-index:10;">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
        <img id='image-modal-img' src='' alt='Imagem ampliada' style='max-width:100%;max-height:95vh;border-radius:8px;box-shadow:0 4px 20px rgba(0,0,0,0.5);'/>
      </div>`;
      document.body.appendChild(modal);
      modal.addEventListener('click', e=>{ if(e.target===modal) closeImageModal(); });
    }
    function openImageModal(imageSrc){
      ensureImageModal();
      const modal = document.getElementById('image-modal');
      const img = document.getElementById('image-modal-img');
      img.src = imageSrc;
      modal.style.display='flex';
    }
    function closeImageModal(){
      const modal = document.getElementById('image-modal');
      if(modal) modal.style.display='none';
    }
  </script>
  
  <!-- Barra de navega√ß√£o inferior mobile -->
  <nav class="mobile-bottom-nav" aria-label="Navega√ß√£o principal mobile">
    <a href="/index" aria-label="Feed" title="Feed">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
        <polyline points="9 22 9 12 15 12 15 22"></polyline>
      </svg>
      <span>In√≠cio</span>
    </a>
    
    <a href="/educacao" aria-label="Educa√ß√£o" title="Educa√ß√£o">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
        <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
      </svg>
      <span>Educa√ß√£o</span>
    </a>
    
    <a href="/novo-post" aria-label="Criar post" title="Criar post" style="background: #ffffff; color: #9B5DE5; border-radius: 50%; width: 48px; height: 48px; margin: -10px 0; padding: 0; display: flex; align-items: center; justify-content: center; flex-direction: row; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
      <svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="#9B5DE5" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
    </a>
    
    <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 4px; padding: 6px 12px; color: #ffffff; opacity: 0.75; font-size: 0.65rem; font-weight: 600; letter-spacing: 0.3px; text-decoration: none;">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"></circle>
        <polyline points="12 6 12 12 16 14"></polyline>
      </svg>
      <span>Em breve</span>
    </div>
    
    <a href="/meu-perfil" aria-label="Perfil" title="Perfil" style="opacity: 1;">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
        <circle cx="12" cy="7" r="4"></circle>
      </svg>
      <span>Perfil</span>
    </a>
  </nav>
</body>
</html>
